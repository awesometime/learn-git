 
- [Python-100-Days](https://github.com/jackfrued/Python-100-Days)

- [æé‡‘è€å¸ˆ Pythonç¬”è®° ã€Šè‡ªå­¦Pythonâ€”â€”ç¼–ç¨‹åŸºç¡€ã€ç§‘å­¦è®¡ç®—åŠæ•°æ®åˆ†æã€‹github.io](http://lijin-thu.github.io/)
  
  [æé‡‘è€å¸ˆ Pythonç¬”è®° ã€Šè‡ªå­¦Pythonâ€”â€”ç¼–ç¨‹åŸºç¡€ã€ç§‘å­¦è®¡ç®—åŠæ•°æ®åˆ†æã€‹Jupyter Notebook Viewer](http://nbviewer.jupyter.org/github/lijin-THU/notes-python/blob/master/index.ipynb)
  
  [æ¸…åå¤§å­¦ æé‡‘è€å¸ˆ Pythonç¬”è®° ã€Šè‡ªå­¦Pythonâ€”â€”ç¼–ç¨‹åŸºç¡€ã€ç§‘å­¦è®¡ç®—åŠæ•°æ®åˆ†æã€‹](https://github.com/lijin-THU/notes-python)
- [äººå·¥æ™ºèƒ½ æœºå™¨å­¦ä¹  æ·±åº¦å­¦ä¹  å…¥é—¨åŠè¿›é˜¶èµ„æ–™](Pythonå…¥é—¨ç½‘ç»œçˆ¬è™«ä¹‹ç²¾åç‰ˆ)
- [Pythonå…¥é—¨ç½‘ç»œçˆ¬è™«ä¹‹ç²¾åç‰ˆ](https://github.com/lining0806/PythonSpiderNotes)

### python36 python37å…±å­˜

```
å°†python36ç›®å½•ä¸‹çš„python.exeçš„åå­—æ”¹æˆpython36.exe   python37ç›®å½•ä¸‹çš„python.exeä»ç„¶ä¸å˜
pyhton36 python37 éƒ½æ·»åŠ path  å‡è®¾python37åœ¨pathçš„é å‰ä½ç½®ï¼Œåˆ™é»˜è®¤å…ˆè¯†åˆ«åˆ°æ˜¯python37
cmd ä¸­ è¾“å…¥pythonæ‰“å¼€çš„æ˜¯python37 python36æ‰“å¼€çš„æ˜¯python36
cmd ä¸­ è¾“å…¥pip3.6åˆ™ä¸‹è½½åˆ°python36ç›®å½•ä¸‹pipåˆ™ä¸‹è½½åˆ°python37ä¸‹

tensorflow åœ¨jupyter notebookä¸­çš„ä½¿ç”¨ï¼šç”±äºtensorflowç›®å‰æ”¯æŒåˆ°python36ï¼š
å…ˆå°†python37ä»pathä¸­åˆ é™¤ï¼Œæ‰“å¼€å°±æ˜¯ç”¨çš„python36è§£é‡Šå™¨
ä½¿ç”¨ç»“æŸéœ€è¦ç”¨python37çš„è¯,æ¯”å¦‚Djangoçš„Xadminï¼Œå†å°†python37æ·»åŠ åˆ°pathï¼ˆåœ¨python36å‰ï¼‰
```
### pythonæºç pass
```
pythonå®šä¹‰å‡½æ•°ï¼Œå¿…é¡»æœ‰å‡½æ•°ä½“ï¼Œå¦åˆ™ç¼–è¯‘å°±ä¼šæŠ¥é”™ã€‚å‡½æ•°ä½“ç”¨ä¸€å¥passå ä½æ˜¯é˜²æ­¢æŠ¥é”™ï¼Œå¹¶ä¸”ä¸ä¼šæœ‰ä»»ä½•åŠ¨ä½œã€‚
è¿™ç§åªæœ‰passçš„å‡½æ•°ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š

1 çˆ¶ç±»ä¸­å£°æ˜å‡½æ•°ï¼Œä½†ä¸å£°æ˜å®ç°ï¼Œç”±ç»§æ‰¿çš„å­ç±»è¿›è¡Œå®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™å°±æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼›
        
2 pythonæ˜¯Cè¯­è¨€å®ç°çš„ï¼Œå°½ç®¡æœ‰å¾ˆå¤šæ ‡å‡†åº“æ˜¯ç”±pythonä»£ç å®ç°ï¼Œä½†æ˜¯æ¶‰åŠåˆ°åº•å±‚æ”¯æ’‘æ¶æ„çš„åŠŸèƒ½è¿˜æ˜¯Cä»£ç ã€‚
  ä¸€äº›IDEä¸ºäº†å¯¹è¿™äº›è¿›è¡Œå‹å¥½ä»£ç æç¤ºï¼Œä¼šå¼„å’Œåº•å±‚ä¸€æ ·çš„è®¿é—®æ¥å£ï¼Œè€Œå…¶å®ç°ç›´æ¥å†™ pass ç•¥è¿‡ã€‚
  æºç åœ¨https://github.com/python/cpython
```
### pipç›¸å…³
pipå®‰è£…æ—¶æŒ‡å®šæ¸…åæºé€Ÿåº¦å¿«,æ¯”å¦‚å®‰è£…lxml  `pip install --index https://mirrors.ustc.edu.cn/pypi/web/simple/  lxml`
```
python pip å®‰è£…æ¨¡å—
C:\Users\li>  python -m pip install pygal
Collecting pygal
  Downloading https://files.pythonhosted.org/packages/5f/b7/201c9254ac0d2b8ffa3bb2d528d23a4130876d9ba90bc28e99633f323f17/pygal-2.4.0-py2.py3-none-any.whl (127kB)
    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 133kB 15kB/s
Installing collected packages: pygal
Successfully installed pygal-2.4.0

æŸ¥çœ‹å®‰è£…è·¯å¾„
C:\Users\li> pip install pygal
Requirement already satisfied: pygal in g:\python\python-3.6.5\lib\site-packages (2.4.0)
```




ä»¥ä¸‹æ€»ç»“è‡ªèœé¸Ÿæ•™ç¨‹

### 2 Python
**æ ‡å‡†åº“**

- [Python 3.8.0a0 documentation](https://docs.python.org/3.8/)
- [The Python Standard Library](https://docs.python.org/3.8/library/index.html)
- [Python 3.5.2ä¸­æ–‡æ–‡æ¡£](https://yiyibooks.cn/xx/python_352/index.html)


**sy**sè°ƒç”¨å‘½ä»¤è¡Œå‚æ•° argv å˜é‡ï¼Œsys è¿˜æœ‰ stdinï¼Œstdout å’Œ stderr å±æ€§ï¼Œå¦å¤–å¤§å¤šè„šæœ¬çš„å®šå‘ç»ˆæ­¢éƒ½ä½¿ç”¨ "sys.exit()"ã€‚

**os**æ¨¡å—æä¾›ä¸æ“ä½œç³»ç»Ÿæ¥å£ç›¸å…³è”çš„å‡½æ•°ï¼Œ

mod ã€shutil æ¨¡å—æä¾›äº†ä¸€ä¸ªæ˜“äºæ—¥å¸¸çš„æ–‡ä»¶å’Œç›®å½•ç®¡ç†çš„é«˜çº§æ¥å£ï¼Œ

globæ¨¡å—æä¾›äº†ä¸€ä¸ªå‡½æ•°ç”¨äºä» ç›®å½•é€šé…ç¬¦æœç´¢ ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨ï¼Œ

**re**æ¨¡å—ä¸ºé«˜çº§å­—ç¬¦ä¸²å¤„ç†æä¾›äº† Perl é£æ ¼çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œre.match ä¸ re.search  , re.subç”¨äºæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„åŒ¹é…é¡¹ ï¼Œ re.compile å‡½æ•°ç”¨äºç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”Ÿæˆä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼ˆ Pattern ï¼‰å¯¹è±¡ï¼Œä¾› match() å’Œ search() è¿™ä¸¤ä¸ªå‡½æ•°ä½¿ç”¨ã€‚

mathæ¨¡å—ä¸ºæµ®ç‚¹è¿ç®—æä¾›äº†å¯¹åº•å±‚Cå‡½æ•°åº“çš„è®¿é—®ï¼Œ

randomæä¾›äº†ç”Ÿæˆéšæœºæ•°çš„å·¥å…·ï¼Œ

urllib.request å¤„ç†ä» urls æ¥æ”¶çš„æ•°æ®çš„ï¼›  smtplib ç”¨äºå‘é€ç”µå­é‚®ä»¶çš„ï¼›(ç”¨äºè®¿é—®äº’è”ç½‘ä»¥åŠå¤„ç†ç½‘ç»œé€šä¿¡åè®®)

datetimeæ¨¡å—ä¸ºæ—¥æœŸå’Œæ—¶é—´å¤„ç†åŒæ—¶æä¾›äº†ç®€å•å’Œå¤æ‚çš„æ–¹æ³•ã€‚

ä»¥ä¸‹æ¨¡å—ç›´æ¥æ”¯æŒé€šç”¨çš„æ•°æ®æ‰“åŒ…å’Œå‹ç¼©æ ¼å¼ï¼šzlibï¼Œgzipï¼Œbz2ï¼Œzipfileï¼Œä»¥åŠ tarfileã€‚

åº¦é‡è§£å†³åŒä¸€é—®é¢˜çš„ä¸åŒæ–¹æ³•ä¹‹é—´çš„æ€§èƒ½ï¼štimeit ç»†ç²’åº¦ï¼› :mod:profile å’Œ pstats æ¨¡å—æä¾›äº†é’ˆå¯¹æ›´å¤§ä»£ç å—çš„æ—¶é—´åº¦é‡å·¥å…·ã€‚

doctest ï¼Œ unittestæ¨¡å—æä¾›äº†ä¸€ä¸ªç”¨äºæµ‹è¯•ä»£ç çš„å·¥å…·ï¼Œæ‰«ææ¨¡å—å¹¶æ ¹æ®ç¨‹åºä¸­å†…åµŒçš„æ–‡æ¡£å­—ç¬¦ä¸²æ‰§è¡Œæµ‹è¯•

**ç¬¬ä¸‰æ–¹æ¨¡å—å®‰è£…**

å¤„ç†å›¾åƒçš„[Pillow](https://pillow.readthedocs.io/en/latest/index.html)ï¼Œ

SQLiteçš„ç‰¹ç‚¹æ˜¯è½»é‡çº§ã€å¯åµŒå…¥ï¼Œä½†ä¸èƒ½æ‰¿å—é«˜å¹¶å‘è®¿é—®ï¼Œé€‚åˆæ¡Œé¢å’Œç§»åŠ¨åº”ç”¨ã€‚
MySQLæ˜¯Webä¸–ç•Œä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ•°æ®åº“æœåŠ¡å™¨ã€‚MySQLæ˜¯ä¸ºæœåŠ¡å™¨ç«¯è®¾è®¡çš„æ•°æ®åº“ï¼Œèƒ½æ‰¿å—é«˜å¹¶å‘è®¿é—®ï¼ŒåŒæ—¶å ç”¨çš„å†…å­˜ä¹Ÿè¿œè¿œå¤§äºSQLiteã€‚
MySQLå†…éƒ¨æœ‰å¤šç§æ•°æ®åº“å¼•æ“ï¼Œæœ€å¸¸ç”¨çš„å¼•æ“æ˜¯æ”¯æŒæ•°æ®åº“äº‹åŠ¡çš„InnoDBã€‚

**MySQLé©±åŠ¨ç¨‹åºï¼ŒMySQLdb å’Œ mysql-connector-python**  
MySQLdbï¼ˆå³MySQL-Pythonï¼‰: å°è£…äº†MySQL Cé©±åŠ¨çš„Pythoné©±åŠ¨å™¨ï¼Œpython 3.xä¸å†æ”¯æŒ
PyMySQL æ˜¯åœ¨ Python3.x ç‰ˆæœ¬ä¸­ç”¨äºè¿æ¥ MySQL æœåŠ¡å™¨çš„ä¸€ä¸ªåº“ã€‚
MySQLå®˜æ–¹æä¾›äº†mysql-connector-pythoné©±åŠ¨ï¼Œä»¥æ”¯æŒPythonè¿æ¥åˆ°MySQLæœåŠ¡å™¨ã€‚

Webæ¡†æ¶Flaskï¼Œç§‘å­¦è®¡ç®—Numpyç­‰ã€‚

matplotlib_venn  æ–‡æ°å›¾çš„ç»˜åˆ¶

ç”¨pipä¸€ä¸ªä¸€ä¸ªå®‰è£…è´¹æ—¶è´¹åŠ›ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¼å®¹æ€§ã€‚

æˆ‘ä»¬æ¨èç›´æ¥ä½¿ç”¨**Anacondaï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºPythonçš„æ•°æ®å¤„ç†å’Œç§‘å­¦è®¡ç®—å¹³å°**ï¼Œå®ƒå·²ç»å†…ç½®äº†è®¸å¤šéå¸¸æœ‰ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œ

æˆ‘ä»¬è£…ä¸ŠAnacondaï¼Œå°±ç›¸å½“äºæŠŠæ•°åä¸ªç¬¬ä¸‰æ–¹æ¨¡å—è‡ªåŠ¨å®‰è£…å¥½äº†ï¼Œéå¸¸ç®€å•æ˜“ç”¨ã€‚

### 3 Python3 ä¸­æœ‰å…­ä¸ªæ ‡å‡†çš„æ•°æ®ç±»å‹ï¼š
- [å†…ç½®çš„åŸå­æ•°æ®ç±»å‹](https://github.com/facert/python-data-structure-cn/blob/master/1.%E4%BB%8B%E7%BB%8D/1.8.%E6%95%B0%E6%8D%AE%E5%85%A5%E9%97%A8/README.md)
```
Numberï¼ˆæ•°å­—ï¼‰           æ•´å‹(Int) æµ®ç‚¹å‹ï¼ˆFloatï¼‰å¤æ•°ï¼ˆComplexï¼‰
                        æ•°å­—ç±»å‹è½¬æ¢int(x)   float(x)   complex(x)   complex(x,y)
Stringï¼ˆå­—ç¬¦ä¸²ï¼‰         **var[1:5]å–å˜é‡çš„ç¬¬äºŒåˆ°äº”ä½(4ä¸ª)ï¼Œä¸åŒ…æ‹¬ç¬¬å…­ä½           è½¬ä¹‰å­—ç¬¦ä¸²  å­—ç¬¦ä¸²è¿ç®— æ ¼å¼åŒ–å­—ç¬¦ä¸²
Listï¼ˆåˆ—è¡¨ï¼‰             æœ‰åº  åˆ—è¡¨å†™åœ¨æ–¹æ‹¬å·[]ä¹‹é—´ï¼Œç”¨é€—å·åˆ†éš”å¼€çš„å…ƒç´ åˆ—è¡¨
Tupleï¼ˆå…ƒç»„ï¼‰                  å…ƒç»„å†™åœ¨å°æ‹¬å· () é‡Œï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€
Setsï¼ˆé›†åˆï¼‰             æ— åº,**ä¸é‡å¤**ç”¨å¤§æ‹¬å· { } æˆ–è€… set() å‡½æ•°åˆ›å»ºé›†åˆ,åˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ set() è€Œä¸æ˜¯ { }ã€‚åŸºæœ¬åŠŸèƒ½åŒ…æ‹¬å…³ç³»æµ‹è¯•å’Œæ¶ˆé™¤é‡å¤å…ƒç´ 
Dictionaryï¼ˆå­—å…¸ï¼‰       æ— åº,{ } æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸,é”®(key) : å€¼(value)å¯¹é›†åˆ,é”®(key)å¿…é¡»ä½¿ç”¨ä¸å¯å˜ç±»å‹ã€‚ 
```
Python3 çš„å…­ä¸ªæ ‡å‡†æ•°æ®ç±»å‹ä¸­ï¼š

| |1 |2 |3 |4|
|-|-|-|-|-|
|ğŸä¸å¯å˜æ•°æ®ï¼ˆå››ä¸ªï¼‰|Numberï¼ˆæ•°å­—ï¼‰|Stringï¼ˆå­—ç¬¦ä¸²ï¼‰|Tupleï¼ˆå…ƒç»„ï¼‰|Setsï¼ˆé›†åˆï¼‰|
|ğŸ¼ å¯å˜æ•°æ®ï¼ˆä¸¤ä¸ªï¼‰  |Listï¼ˆåˆ—è¡¨ï¼‰  |Dictionaryï¼ˆå­—å…¸ï¼‰|||
|ğŸŒ³æœ‰åº |            Listï¼ˆåˆ—è¡¨ï¼‰|Stringï¼ˆå­—ç¬¦ä¸²ï¼‰|Tupleï¼ˆå…ƒç»„ï¼‰||
|ğŸ¯æ— åº|             Dictionaryï¼ˆå­—å…¸ï¼‰|Setsï¼ˆé›†åˆï¼‰|||



tupleçš„å…ƒç´ ä¸å¯æ”¹å˜ï¼Œä½†å®ƒå¯ä»¥åŒ…å«å¯å˜çš„å¯¹è±¡ï¼Œæ¯”å¦‚liståˆ—è¡¨ã€‚
    æ„é€ åŒ…å« 0 ä¸ªæˆ– 1 ä¸ªå…ƒç´ çš„å…ƒç»„æ¯”è¾ƒç‰¹æ®Šï¼Œæ‰€ä»¥æœ‰ä¸€äº›é¢å¤–çš„è¯­æ³•è§„åˆ™ï¼š
    tup1 = ()    # ç©ºå…ƒç»„
    tup2 = (20,) # ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å…ƒç´ åæ·»åŠ é€—å·

### 4 Python3 è§£é‡Šå™¨
### 5  ifåˆ¤æ–­

if isinstane(object, classinfo) å¦‚æœå‚æ•° object æ˜¯å‚æ•° classinfo çš„å®ä¾‹ï¼Œè¿”å›çœŸï¼Œå¦åˆ™å‡ï¼›

å‚æ•° classinfo å¯ä»¥æ˜¯ä¸€ä¸ªåŒ…å«è‹¥å¹² type å¯¹è±¡çš„å…ƒç¥–ï¼Œå¦‚æœå‚æ•° object æ˜¯å…¶ä¸­ä»»æ„ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œè¿”å›çœŸï¼Œå¦åˆ™å‡

```
def __init__(self, path_or_image):
    # è‹¥ path_or_image ä¸º Image.Image ç±»å‹çš„å®ä¾‹ï¼Œç›´æ¥èµ‹å€¼
    if isinstance(path_or_image, Image.Image):
        self.image = path_or_image
    # è‹¥ path_or_image ä¸º str ç±»å‹çš„å®ä¾‹ï¼Œæ‰“å¼€å›¾ç‰‡
    elif isinstance(path_or_image, str):
        self.image = Image.open(path_or_image)
```
### 6 Python3 è¿ç®—ç¬¦
Pythonè¯­è¨€æ”¯æŒä»¥ä¸‹ç±»å‹çš„è¿ç®—ç¬¦:
```
ç®—æœ¯è¿ç®—ç¬¦            + - * / % ** // (å¾—åˆ°çš„å¹¶ä¸€å®šæ˜¯æ•´æ•°ç±»å‹çš„æ•°ï¼Œå®ƒä¸åˆ†æ¯åˆ†å­çš„æ•°æ®ç±»å‹æœ‰å…³ç³»ã€‚ 7.0 // 2= 3.0)
æ¯”è¾ƒï¼ˆå…³ç³»ï¼‰è¿ç®—ç¬¦     ==  !=  >  <  >=  <=
èµ‹å€¼è¿ç®—ç¬¦            += -= *= /= %= **= //=
é€»è¾‘è¿ç®—ç¬¦            andå¸ƒå°”ä¸   orå¸ƒå°”æˆ–       notå¸ƒå°”é 
ä½è¿ç®—ç¬¦              &ä¸¤ä¸ªéƒ½ä¸º1,åˆ™ç»“æœä¸º1   |æœ‰ä¸€ä¸ªä¸º1ï¼Œç»“æœä¸º1   ^äºŒä½ä¸ç›¸åŒæ—¶ï¼Œç»“æœä¸º1   ~æŒ‰ä½å–å  >>å³ç§»  <<nå·¦ç§»nä½ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥0ã€‚
æˆå‘˜è¿ç®—ç¬¦            in    not in
èº«ä»½è¿ç®—ç¬¦            is    is not                 id() å‡½æ•°ç”¨äºè·å–å¯¹è±¡å†…å­˜åœ°å€ã€‚
è¿ç®—ç¬¦ä¼˜å…ˆçº§
```
```
ä¸¤ä¸ªé›†åˆçš„æ“ä½œ
>>> a = set('abracadabra')
>>> b = set('alacazam')
>>> a                                  # a ä¸­å”¯ä¸€çš„å­—æ¯
{'a', 'r', 'b', 'c', 'd'}
>>> a - b                              # åœ¨ a ä¸­çš„å­—æ¯ï¼Œä½†ä¸åœ¨ b ä¸­
{'r', 'd', 'b'}
>>> a | b                              # åœ¨ a æˆ– b ä¸­çš„å­—æ¯
{'a', 'c', 'r', 'd', 'b', 'm', 'z', 'l'}
>>> a & b                              # åœ¨ a å’Œ b ä¸­éƒ½æœ‰çš„å­—æ¯
{'a', 'c'}
>>> a ^ b                              # åœ¨ a æˆ– b ä¸­çš„å­—æ¯ï¼Œä½†ä¸åŒæ—¶åœ¨ a å’Œ b ä¸­
{'r', 'd', 'b', 'm', 'z', 'l'}
```
```
Pythonä¸­å˜é‡åœ¨ä½¿ç”¨å‰éƒ½å¿…é¡»èµ‹å€¼,ä½†ä¸éœ€è¦å£°æ˜ã€‚

ä¸åŒºåˆ†å•åŒå¼•å·

oå…«è¿›åˆ¶ xåå…­è¿›åˆ¶

åœ¨ python ä¸­ï¼Œç±»å‹å±äºå¯¹è±¡ï¼Œå˜é‡æ˜¯æ²¡æœ‰ç±»å‹çš„ï¼ša=[1,2,3]           a="Runoob"
ä»¥ä¸Šä»£ç ä¸­ï¼Œ[1,2,3] æ˜¯ List ç±»å‹ï¼Œ"Runoob" æ˜¯ String ç±»å‹ï¼Œè€Œå˜é‡ a æ˜¯æ²¡æœ‰ç±»å‹ï¼Œ
å¥¹ä»…ä»…æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆä¸€ä¸ªæŒ‡é’ˆï¼‰ï¼Œå¯ä»¥æ˜¯æŒ‡å‘ List ç±»å‹å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡å‘ String ç±»å‹å¯¹è±¡ã€‚

is ä¸ == åŒºåˆ«ï¼š   ???
is ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå˜é‡å¼•ç”¨å¯¹è±¡æ˜¯å¦ä¸ºåŒä¸€ä¸ªï¼Œ == ç”¨äºåˆ¤æ–­å¼•ç”¨å˜é‡çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚

åœ¨äº¤äº’æ¨¡å¼ä¸­ï¼Œæœ€åè¢«è¾“å‡ºçš„è¡¨è¾¾å¼ç»“æœè¢«èµ‹å€¼ç»™å˜é‡ _ ã€‚ _ å˜é‡åº”è¢«ç”¨æˆ·è§†ä¸ºåªè¯»å˜é‡ã€‚

round(floatï¼Œ n) æ–¹æ³•è¿”å›æµ®ç‚¹æ•° float çš„ n ä½å››èˆäº”å…¥å€¼ã€‚    è¯¦è§Python3 æ•°å­—

list(range(2,2))  è¿”å›[]        list(range(0, 1))è¿”å›[0]          list(range(1, 0))è¿”å›[],é»˜è®¤æ­¥é•¿+1ï¼Œæ‰€ä»¥åˆ°ä¸äº†0
```
```
è¿ç®—ç¬¦ä¼˜å…ˆçº§      	æè¿°
**	                  æŒ‡æ•° (æœ€é«˜ä¼˜å…ˆçº§)
~ + -	                æŒ‰ä½ç¿»è½¬, ä¸€å…ƒåŠ å·å’Œå‡å· (æœ€åä¸¤ä¸ªçš„æ–¹æ³•åä¸º +@ å’Œ -@)
* / % //	           ä¹˜ï¼Œé™¤ï¼Œå–æ¨¡å’Œå–æ•´é™¤
+ -	                 åŠ æ³•å‡æ³•
>> <<	               å³ç§»ï¼Œå·¦ç§»è¿ç®—ç¬¦
&	                   ä½ 'AND'
^ |	                 ä½è¿ç®—ç¬¦
<= < > >=	           æ¯”è¾ƒè¿ç®—ç¬¦
<> == !=	           ç­‰äºè¿ç®—ç¬¦
= %= /= //= -= += *= **=	èµ‹å€¼è¿ç®—ç¬¦
is is not	           èº«ä»½è¿ç®—ç¬¦
in not in	           æˆå‘˜è¿ç®—ç¬¦
and or not	         é€»è¾‘è¿ç®—ç¬¦
```
### 7 Python3 æ•°å­—(Number)
æ•°å­¦å‡½æ•°
éšæœºæ•°å‡½æ•°
ä¸‰è§’å‡½æ•°
å¸¸é‡ Ï€ e
### 8 Python3 å­—ç¬¦ä¸²
print("12" , "34")
12 34   ä¼šè‡ªåŠ¨äº§ç”Ÿä¸€ä¸ªç©ºæ ¼

å­—ç¬¦ä¸²å¯¹è±¡çš„ rjust() æ–¹æ³•, å®ƒå¯ä»¥å°†å­—ç¬¦ä¸²é å³, å¹¶åœ¨å·¦è¾¹å¡«å……ç©ºæ ¼ã€‚

è¿˜æœ‰ç±»ä¼¼çš„æ–¹æ³•, å¦‚ ljust() å’Œ center()ã€‚ è¿™äº›æ–¹æ³•å¹¶ä¸ä¼šå†™ä»»ä½•ä¸œè¥¿, å®ƒä»¬ä»…ä»…è¿”å›æ–°çš„å­—ç¬¦ä¸²ã€‚

å¦ä¸€ä¸ªæ–¹æ³• zfill(), å®ƒä¼šåœ¨æ•°å­—çš„å·¦è¾¹å¡«å…… 0

str.format() çš„åŸºæœ¬ä½¿ç”¨å¦‚ä¸‹:
```
>>> print('{}ç½‘å€ï¼š "{}!"'.format('èœé¸Ÿæ•™ç¨‹', 'www.runoob.com'))
èœé¸Ÿæ•™ç¨‹ç½‘å€ï¼š "www.runoob.com!"
```
```
åœ¨æ‹¬å·ä¸­çš„æ•°å­—ç”¨äºæŒ‡å‘ä¼ å…¥å¯¹è±¡åœ¨ format() ä¸­çš„ä½ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

>>> print('{0} å’Œ {1}'.format('Google', 'Runoob'))
Google å’Œ Runoob
>>> print('{1} å’Œ {0}'.format('Google', 'Runoob'))
Runoob å’Œ Google
```
### 9 Python3 åˆ—è¡¨

### 10 Python3 å¾ªç¯è¯­å¥

break è¯­å¥å¯ä»¥è·³å‡º for å’Œ while çš„å¾ªç¯ä½“ã€‚å¦‚æœä½ ä» for æˆ– while å¾ªç¯ä¸­ç»ˆæ­¢ï¼Œä»»ä½•å¯¹åº”çš„å¾ªç¯ else å—å°†ä¸æ‰§è¡Œã€‚

continueè¯­å¥è¢«ç”¨æ¥å‘Šè¯‰Pythonè·³è¿‡å½“å‰å¾ªç¯å—ä¸­çš„å‰©ä½™è¯­å¥ï¼Œç„¶åç»§ç»­è¿›è¡Œä¸‹ä¸€è½®å¾ªç¯ã€‚

forå¾ªç¯å…¶å®å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç”šè‡³å¤šä¸ªå˜é‡ï¼Œæ¯”å¦‚dictçš„items()å¯ä»¥åŒæ—¶è¿­ä»£keyå’Œvalue:
```   
   for k, v in d.items():
        print(k, '=', v)
```
### 11 Python3 æ¨¡å—

æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª__name__å±æ€§ï¼Œå½“å…¶å€¼æ˜¯'__main__'æ—¶ï¼Œè¡¨æ˜è¯¥æ¨¡å—åªåœ¨æœ¬ç¨‹åºå†…éƒ¨è¿è¡Œï¼Œå…¶ä»–ç¨‹åºä¸­å¯¼å…¥è¯¥æ¨¡å—å¹¶ä¸ä¼šæ‰§è¡Œã€‚

å†…ç½®çš„å‡½æ•° dir() å¯ä»¥æ‰¾åˆ°æ¨¡å—å†…å®šä¹‰çš„æ‰€æœ‰åç§°ã€‚ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼è¿”å›:
```
>>> import  sys

>>> dir(sys)  

['__displayhook__', '__doc__', '__excepthook__', '__loader__', '__name__',ç­‰ç­‰]
```


import sound.effects.echo  å¿…é¡»ä½¿ç”¨å…¨åå»è®¿é—®:

sound.effects.echo.echofilter

from sound.effects import echo   è¿™åŒæ ·ä¼šå¯¼å…¥å­æ¨¡å—: echoï¼Œä½†ä»–ä¸éœ€è¦é‚£äº›å†—é•¿çš„å‰ç¼€ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨:

echo.echofilter

åŒ…å®šä¹‰æ–‡ä»¶ __init__.py å­˜åœ¨ä¸€ä¸ªå«åš __all__ çš„åˆ—è¡¨å˜é‡ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨ from package import * çš„æ—¶å€™å°±æŠŠè¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰åå­—ä½œä¸ºåŒ…å†…å®¹å¯¼å…¥ã€‚
 
### 12 Python3   å¤šè¿›ç¨‹ multiprocessing    å¤šçº¿ç¨‹ threading     (å‚è€ƒå»–é›ªå³°)

[multiprocessing  threading](https://mp.weixin.qq.com/s?__biz=MjM5OTMyODA4Nw==&mid=2247484084&idx=1&sn=573989b9526aef01a3d515ab09afe86a&chksm=a73c628c904beb9a39adef9b95a1ce6560245b7f4e2a39207a55abc1a293935be203a35bcb13&mpshare=1&scene=1&srcid=&pass_ticket=0QnHRl6v1Xkew4C5DrpSerNBri6BPOinWKKfydIySHIIQ%2BKJhsjSdnkU2wZYGdie#rd)

```
è¿›ç¨‹ ä¼˜å…ˆçº§äº çº¿ç¨‹  ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹

çº¿ç¨‹æ˜¯æœ€å°çš„è°ƒåº¦æ‰§è¡Œå•å…ƒã€‚å¦‚ä½•è°ƒåº¦è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œå®Œå…¨ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚

å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„ç¨‹åºæ¶‰åŠåˆ°åŒæ­¥ã€æ•°æ®å…±äº«çš„é—®é¢˜ï¼Œç¼–å†™èµ·æ¥æ›´å¤æ‚ã€‚

æ€»ç»“ä¸€å¥è¯æ˜¯â€œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒâ€ã€‚

- è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨,è¿›ç¨‹æ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½.

- çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“,æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½,å®ƒæ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½.çº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰
ç³»ç»Ÿèµ„æº,åªæ‹¥æœ‰ä¸€ç‚¹åœ¨è¿è¡Œä¸­å¿…ä¸å¯å°‘çš„èµ„æº(å¦‚ç¨‹åºè®¡æ•°å™¨,ä¸€ç»„å¯„å­˜å™¨å’Œæ ˆ),ä½†æ˜¯å®ƒå¯ä¸åŒå±ä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çš„çº¿ç¨‹å…±
äº«è¿›ç¨‹æ‰€æ‹¥æœ‰çš„å…¨éƒ¨èµ„æº.ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå’Œæ’¤é”€å¦ä¸€ä¸ªçº¿ç¨‹;åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘æ‰§è¡Œ.

- è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼ã€‚è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼
ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œè€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬
çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ï¼Œæ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®ï¼Œä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶ï¼Œè€—è´¹èµ„æºè¾ƒ
å¤§ï¼Œæ•ˆç‡è¦å·®ä¸€äº›ã€‚ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œï¼Œåªèƒ½ç”¨çº¿ç¨‹ï¼Œä¸èƒ½ç”¨è¿›ç¨‹ã€‚

```
**Pythonä¸­å¤šçº¿ç¨‹ç”±äºæœ‰GILçš„å½±å“ï¼Œ å¯¼è‡´åœ¨ä»»ä½•æ—¶åˆ»ä»…æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ**

**å³ä¾¿åœ¨å¤šæ ¸å¿ƒå¤„ç†å™¨ä¸Šï¼Œä½¿ç”¨ GIL çš„è§£é‡Šå™¨ä¹Ÿåªå…è®¸åŒä¸€æ—¶é—´æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹**
```
å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹æœ€å¤§çš„ä¸åŒåœ¨äºï¼Œ

**å¤šè¿›ç¨‹**ä¸­ï¼ŒåŒä¸€ä¸ªå˜é‡ï¼Œå„è‡ªæœ‰ä¸€ä»½æ‹·è´å­˜åœ¨äºæ¯ä¸ªè¿›ç¨‹ä¸­ï¼Œäº’ä¸å½±å“.

**å¤šçº¿ç¨‹**ä¸­ï¼Œæ‰€æœ‰å˜é‡éƒ½ç”±æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ‰€ä»¥ï¼Œä»»ä½•ä¸€ä¸ªå˜é‡éƒ½å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹.

å› æ­¤ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®æœ€å¤§çš„å±é™©åœ¨äºå¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¹ä¸€ä¸ªå˜é‡ï¼ŒæŠŠå†…å®¹ç»™æ”¹ä¹±äº†ã€‚
```

```
Pythonå¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å“ªä¸ªå¿«?

ç”±äºGILçš„å­˜åœ¨ï¼Œå¾ˆå¤šäººè®¤ä¸ºPythonå¤šè¿›ç¨‹ç¼–ç¨‹æ›´å¿«ï¼Œé’ˆå¯¹å¤šæ ¸CPUï¼Œç†è®ºä¸Šæ¥è¯´ä¹Ÿæ˜¯é‡‡ç”¨å¤šè¿›ç¨‹æ›´èƒ½æœ‰æ•ˆåˆ©ç”¨èµ„æºã€‚ç»“è®ºã€‚

    å¯¹CPUå¯†é›†å‹ä»£ç (æ¯”å¦‚å¾ªç¯è®¡ç®—) - å¤šè¿›ç¨‹æ•ˆç‡æ›´é«˜

    å¯¹IOå¯†é›†å‹ä»£ç (æ¯”å¦‚æ–‡ä»¶æ“ä½œï¼Œç½‘ç»œçˆ¬è™«) - å¤šçº¿ç¨‹æ•ˆç‡æ›´é«˜ã€‚

ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸éš¾ç†è§£ã€‚å¯¹äºIOå¯†é›†å‹æ“ä½œï¼Œå¤§éƒ¨åˆ†æ¶ˆè€—æ—¶é—´å…¶å®æ˜¯ç­‰å¾…æ—¶é—´ï¼Œåœ¨ç­‰å¾…æ—¶é—´ä¸­CPUæ˜¯ä¸éœ€è¦å·¥ä½œçš„ï¼Œ

é‚£ä½ åœ¨æ­¤æœŸé—´æä¾›åŒCPUèµ„æºä¹Ÿæ˜¯åˆ©ç”¨ä¸ä¸Šçš„ï¼Œç›¸åå¯¹äºCPUå¯†é›†å‹ä»£ç ï¼Œ2ä¸ªCPUå¹²æ´»è‚¯å®šæ¯”ä¸€ä¸ªCPUå¿«å¾ˆå¤šã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ä¼šå¯¹IOå¯†é›†å‹ä»£ç æœ‰ç”¨å‘¢ï¼Ÿè¿™æ—¶å› ä¸ºpythonç¢°åˆ°ç­‰å¾…ä¼šé‡Šæ”¾GILä¾›æ–°çš„çº¿ç¨‹ä½¿ç”¨ï¼Œå®ç°äº†çº¿ç¨‹é—´çš„åˆ‡æ¢ã€‚

Pythonä¸­å¤šçº¿ç¨‹ç”±äºæœ‰GILçš„å½±å“ï¼Œ å¯¼è‡´åœ¨ä»»æ„æ—¶é—´å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œæ‰€ä»¥Pythonçš„å¤šçº¿ç¨‹åœ¨å¤„ç†è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸Š
æ•ˆæœåè€Œä¸å¦‚å•çº¿ç¨‹ï¼Œ åªæœ‰åœ¨å¤„ç†IOå¯†é›†å‹ä»»åŠ¡ä¸Šå¤šçº¿ç¨‹æ‰èƒ½å‘æŒ¥å®åŠ›ï¼Œåœ¨ç­‰å¾…IOè¿‡ç¨‹ä¸­Python Cæºç ä¼šé‡Šæ”¾GILï¼Œ æœ€ç»ˆ
ä¼šå¯¼è‡´çº¿ç¨‹åœ¨ç­‰å¾…IOè¿‡ç¨‹ä¸­ä¼šè¢«æš‚åœå»æ‰§è¡Œå…¶ä»–çš„çº¿ç¨‹ã€‚pythonä¸­GILä¸»è¦æ˜¯ç”±äºå†å²åŸå› å¯¼è‡´Cpythonè™šæ‹Ÿæœºä¸­çš„GILéš¾ä»¥
ç§»é™¤ï¼ŒåŒæ—¶GILçš„å­˜åœ¨ä¿è¯äº†å¤šçº¿ç¨‹ä¹‹é—´æ•°æ®å®Œæ•´æ€§ä»¥åŠçŠ¶æ€åŒæ­¥ã€‚

```


>>> **12.1 å¤šè¿›ç¨‹ multiprocessing**

**12.1.1 å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹å¹¶ç­‰å¾…å…¶ç»“æŸ**   `os.getpid()  p.start()  p.join()`

å•è¿›ç¨‹ä»£ç 
```python3
import time
import os

def long_time_task():
    print('å½“å‰è¿›ç¨‹: {}'.format(os.getpid()))
    time.sleep(2)
    print("ç»“æœ: {}".format(8 ** 20))

if __name__ == "__main__":
    print('å½“å‰æ¯è¿›ç¨‹: {}'.format(os.getpid()))
    start = time.time()
    for i in range(2):
        long_time_task()

    end = time.time()
    print("ç”¨æ—¶{}ç§’".format((end-start)))

### 
å½“å‰æ¯è¿›ç¨‹: 14236
å½“å‰è¿›ç¨‹: 14236
ç»“æœ: 1152921504606846976
å½“å‰è¿›ç¨‹: 14236
ç»“æœ: 1152921504606846976
ç”¨æ—¶4.01080060005188ç§’
```

multiprocessingæ¨¡å—ï¼ˆå…·æœ‰è·¨å¹³å°ç‰¹æ€§ï¼‰æä¾›äº†ä¸€ä¸ªProcessç±»æ¥ä»£è¡¨ä¸€ä¸ªè¿›ç¨‹å¯¹è±¡

```python3
from multiprocessing import Process
import time,os

def run_proc(name):                           # å®šä¹‰ä¸€ä¸ªæ‰§è¡Œå‡½æ•°run_procå’Œå‡½æ•°çš„å‚æ•°name
    print('Run child process %s (%s)...' % (name, os.getpid()))      #os.getpid()è·å–å½“å‰è¿›ç¨‹id , os.getppid()è·å–çˆ¶è¿›ç¨‹id 

if __name__=='__main__':
    print('Parent process %s.' % os.getpid())      # æ‰“å°å½“å‰è¿›ç¨‹(çˆ¶è¿›ç¨‹)id
    start = time.time()
    p1=Process(target=run_proc, args=('test',))     # ä¼ å…¥å‚æ•°ï¼Œåˆ›å»ºä¸€ä¸ªProcesså®ä¾‹ï¼Œå³åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼›targetä¸ºå­è¿›ç¨‹å‡½æ•°ï¼Œargsä¸­çš„testä¼ ç»™run_procçš„å‚æ•°
    p2=Process(target=run_proc, args=('test',))
    print('ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹å®Œæˆã€‚')
    p1.start()                                     # å¼€å¯ä¸€ä¸ªè¿›ç¨‹
    p2.start()
    p1.join()                                      # ç­‰å¾…è¯¥è¿›ç¨‹è¿è¡Œç»“æŸ
    p2.join()                                      # ç­‰å¾…è¯¥è¿›ç¨‹è¿è¡Œç»“æŸ
    end = time.time()
    print("æ€»å…±ç”¨æ—¶{}ç§’".format((end - start)))
    
# åœ¨Windows ä¸Šå®é™…å¹¶æœªçœ‹åˆ°å­è¿›ç¨‹çš„è¾“å‡ºï¼Œå¹³å°åŸå› ï¼Ÿï¼Ÿï¼Ÿ 
# è¾“å‡ºä¸å¯¹åº”
å½“å‰æ¯è¿›ç¨‹: 6920
ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹å®Œæˆã€‚
å­è¿›ç¨‹: 17020 - ä»»åŠ¡1
å­è¿›ç¨‹: 5904 - ä»»åŠ¡2
ç»“æœ: 1152921504606846976
ç»“æœ: 1152921504606846976
æ€»å…±ç”¨æ—¶2.131091356277466ç§’
```    

å¦ä¸€ç§æ–¹æ³•ï¼šåˆ›å»ºä¸€ä¸ªç±»ç»§æ‰¿Processç±»ï¼Œå¹¶é‡å†™runæ–¹æ³•ã€‚[å‚è€ƒ](https://www.cnblogs.com/hypnus-ly/p/8129205.html)
    

**12.1.2 Pool  æ‰¹é‡åˆ›å»ºå­è¿›ç¨‹**   `p.apply_async` 

```python3
ä¸‹é¢ä»‹ç»ä¸€ä¸‹multiprocessing æ¨¡å—ä¸‹çš„Poolç±»çš„å‡ ä¸ªæ–¹æ³•ï¼š

1.apply_async

å‡½æ•°åŸå‹ï¼šapply_async(func[, args=()[, kwds={}[, callback=None]]])

å…¶ä½œç”¨æ˜¯å‘è¿›ç¨‹æ± æäº¤éœ€è¦æ‰§è¡Œçš„å‡½æ•°åŠå‚æ•°ï¼Œ å„ä¸ªè¿›ç¨‹é‡‡ç”¨éé˜»å¡ï¼ˆå¼‚æ­¥ï¼‰çš„è°ƒç”¨æ–¹å¼ï¼Œå³æ¯ä¸ªå­è¿›ç¨‹åªç®¡è¿è¡Œè‡ªå·±çš„ï¼Œä¸ç®¡å…¶å®ƒè¿›ç¨‹æ˜¯å¦å·²ç»å®Œæˆã€‚

2.map()

å‡½æ•°åŸå‹ï¼šmap(func, iterable[, chunksize=None])

Poolç±»ä¸­çš„mapæ–¹æ³•ï¼Œä¸å†…ç½®çš„mapå‡½æ•°ç”¨æ³•è¡Œä¸ºåŸºæœ¬ä¸€è‡´ï¼Œå®ƒä¼šä½¿è¿›ç¨‹é˜»å¡ç›´åˆ°ç»“æœè¿”å›ã€‚ æ³¨æ„ï¼šè™½ç„¶ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¿…é¡»åœ¨æ•´ä¸ªé˜Ÿåˆ—éƒ½å°±ç»ªåï¼Œç¨‹åºæ‰ä¼šè¿è¡Œå­è¿›ç¨‹ã€‚

3.map_async()

å‡½æ•°åŸå‹ï¼šmap_async(func, iterable[, chunksize[, callback]])
ä¸mapç”¨æ³•ä¸€è‡´ï¼Œä½†æ˜¯å®ƒæ˜¯éé˜»å¡çš„ã€‚å…¶æœ‰å…³äº‹é¡¹è§apply_asyncã€‚

4.close()

å…³é—­è¿›ç¨‹æ± ï¼ˆpoolï¼‰ï¼Œä½¿å…¶ä¸åœ¨æ¥å—æ–°çš„ä»»åŠ¡ã€‚

5. terminate()

ç»“æŸå·¥ä½œè¿›ç¨‹ï¼Œä¸åœ¨å¤„ç†æœªå¤„ç†çš„ä»»åŠ¡ã€‚

6.join()

ä¸»è¿›ç¨‹é˜»å¡ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡ºï¼Œ joinæ–¹æ³•è¦åœ¨closeæˆ–terminateä¹‹åä½¿ç”¨ã€‚
```

```python3
from multiprocessing import Pool, cpu_count
import os, time, random

def long_time_task(name):
    print('Run task %s (%s)...' % (name, os.getpid()))
    start = time.time()
    time.sleep(random.random() * 3)
    end = time.time()
    print('Task %s runs %0.2f seconds.' % (name, (end - start)))   # ç”¨time.sleepç»“åˆéšæœºå‡½æ•°æ¥æŒ‡å®šæ¯ä¸ªè¿›ç¨‹æ‰§è¡Œå¤šé•¿æ—¶é—´

if __name__=='__main__':
    print("CPUå†…æ ¸æ•°:{}".format(cpu_count()))
    print('å½“å‰æ¯è¿›ç¨‹: {}'.format(os.getpid()))
    p = Pool(4)                   # åŒæ—¶è·‘4ä¸ªè¿›ç¨‹ï¼Œé»˜è®¤å¤§å°æ˜¯CPUçš„æ ¸æ•°
    for i in range(6):            # æ€»å…±6ä¸ªè¿›ç¨‹ï¼Œç”±äºåªèƒ½åŒæ—¶è·‘4ä¸ªè¿›ç¨‹ï¼Œéœ€è¦ç­‰å‰è¾¹4ä¸ªä¸­æŸä¸ªç»“æŸæ‰èƒ½åŠ å…¥ä¸€ä¸ªæ–°çš„è¿›ç¨‹
        p.apply_async(long_time_task, args=(i,))
    
    p.close()  # å¯¹Poolå¯¹è±¡è°ƒç”¨join()æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œè°ƒç”¨join()ä¹‹å‰å¿…é¡»å…ˆè°ƒç”¨close()æˆ–terminate()æ–¹æ³•ï¼Œè®©å…¶ä¸å†æ¥å—æ–°çš„Processäº†ã€‚
    p.join()                                      # ç­‰å¾…è¯¥è¿›ç¨‹è¿è¡Œç»“æŸ
    
# åœ¨Windows ä¸Šå®é™…å¹¶æœªçœ‹åˆ°å­è¿›ç¨‹çš„è¾“å‡ºï¼Ÿï¼Ÿï¼Ÿ
```
 **12.1.3 å¤šè¿›ç¨‹é—´çš„æ•°æ®å…±äº«ä¸Processé—´é€šä¿¡**
 
Pythonçš„multiprocessingæ¨¡å—åŒ…è£…äº†åº•å±‚çš„æœºåˆ¶ï¼Œæä¾›äº†`Queueã€Pipes`ç­‰å¤šç§æ–¹å¼æ¥äº¤æ¢æ•°æ®ã€‚æˆ‘ä»¬ä»¥``Queue``ä¸ºä¾‹  
```python3
from multiprocessing import Process, Queue
queue æ¨¡å—
queue.Queue         class 
queue.Queue.qsize() 
queue.Queue.empty()
queue.Queue.full()
queue.Queue.put(item, block=True, timeout=None) 
queue.Queue.put_nowait(item)
queue.Queue.get(block=True, timeout=None)
queue.Queue.get_nowait()
queue.Queue.join()
p = Process(target='xxx', args=('queue',))
```
ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ 
```python3
from multiprocessing import Process, Queue
import os, time, random

# å†™æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :
def write(q):
    print('Process to write: %s' % os.getpid())
    for value in ['A', 'B', 'C']:
        print('Put %s to queue...' % value)
        q.put(value)                                  # å°†xxxå†™å…¥åˆ°Queue
        time.sleep(random.random())

# è¯»æ•°æ®è¿›ç¨‹æ‰§è¡Œçš„ä»£ç :
def read(q):
    print('Process to read: %s' % os.getpid())
    while True:
        value = q.get(True)
        print('Get %s from queue.' % value)           # ä»Queueè¯»å‡ºxxx

if __name__=='__main__':
    # çˆ¶è¿›ç¨‹åˆ›å»ºQueueï¼Œå¹¶ä¼ ç»™å„ä¸ªå­è¿›ç¨‹ï¼š
    q = Queue()
    pw = Process(target=write, args=(q,))
    pr = Process(target=read, args=(q,))             # åˆ›å»ºå­è¿›ç¨‹pwï¼Œpr
    # å¯åŠ¨å­è¿›ç¨‹pwï¼Œå†™å…¥:
    pw.start()
    # å¯åŠ¨å­è¿›ç¨‹prï¼Œè¯»å–:
    pr.start()
    # ç­‰å¾…pwç»“æŸ:
    pw.join()
    # prè¿›ç¨‹é‡Œæ˜¯æ­»å¾ªç¯ï¼Œæ— æ³•ç­‰å¾…å…¶ç»“æŸï¼Œåªèƒ½å¼ºè¡Œç»ˆæ­¢:
    pr.terminate()        ï¼Ÿï¼Ÿï¼Ÿ
    
# åœ¨Windows ä¸Šå®é™…å¹¶æœªçœ‹åˆ°å­è¿›ç¨‹çš„è¾“å‡ºï¼Ÿï¼Ÿï¼Ÿ
 ```

>>> **12.2 å¤šçº¿ç¨‹ Threading** 

Pythonçš„çº¿ç¨‹æ˜¯çœŸæ­£çš„Posix Threadï¼Œè€Œä¸æ˜¯æ¨¡æ‹Ÿå‡ºæ¥çš„çº¿ç¨‹ã€‚

Pythonçš„çº¿ç¨‹è™½ç„¶æ˜¯çœŸæ­£çš„çº¿ç¨‹ï¼Œä½†è§£é‡Šå™¨æ‰§è¡Œä»£ç æ—¶ï¼Œæœ‰ä¸€ä¸ªGILé”ï¼šGlobal Interpreter Lockï¼Œä»»ä½•Pythonçº¿ç¨‹æ‰§è¡Œå‰ï¼Œ

å¿…é¡»å…ˆè·å¾—GILé”ï¼Œç„¶åï¼Œæ¯æ‰§è¡Œ100æ¡å­—èŠ‚ç ï¼Œè§£é‡Šå™¨å°±è‡ªåŠ¨é‡Šæ”¾GILé”ï¼Œè®©åˆ«çš„çº¿ç¨‹æœ‰æœºä¼šæ‰§è¡Œã€‚

è¿™ä¸ªGILå…¨å±€é”å®é™…ä¸ŠæŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰§è¡Œä»£ç éƒ½ç»™ä¸Šäº†é”ï¼Œæ‰€ä»¥ï¼Œå¤šçº¿ç¨‹åœ¨Pythonä¸­åªèƒ½äº¤æ›¿æ‰§è¡Œï¼Œ

å³ä½¿100ä¸ªçº¿ç¨‹è·‘åœ¨100æ ¸CPUä¸Šï¼Œä¹Ÿ**åªèƒ½ç”¨åˆ°1ä¸ªæ ¸**ã€‚

GIL(Global Interpreter Lock)å…¨å±€è§£é‡Šå™¨é”:æ˜¯Pythonè§£é‡Šå™¨è®¾è®¡çš„å†å²é—ç•™é—®é¢˜ï¼Œé€šå¸¸æˆ‘ä»¬ç”¨çš„è§£é‡Šå™¨æ˜¯å®˜æ–¹å®ç°çš„CPythonï¼Œè¦çœŸæ­£åˆ©ç”¨å¤šæ ¸ï¼Œ

é™¤éé‡å†™ä¸€ä¸ªä¸å¸¦GILçš„è§£é‡Šå™¨ã€‚æ‰€ä»¥ï¼Œåœ¨Pythonä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œä½†**ä¸è¦æŒ‡æœ›èƒ½æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸**ã€‚

å¦‚æœä¸€å®šè¦é€šè¿‡å¤šçº¿ç¨‹åˆ©ç”¨å¤šæ ¸ï¼Œé‚£åªèƒ½é€šè¿‡Cæ‰©å±•æ¥å®ç°ï¼Œä¸è¿‡è¿™æ ·å°±å¤±å»äº†Pythonç®€å•æ˜“ç”¨çš„ç‰¹ç‚¹ã€‚

ä¸è¿‡ï¼Œä¹Ÿä¸ç”¨è¿‡äºæ‹…å¿ƒï¼ŒPythonè™½ç„¶**ä¸èƒ½**åˆ©ç”¨**å¤šçº¿ç¨‹**å®ç°å¤šæ ¸ä»»åŠ¡ï¼Œä½†å¯ä»¥é€šè¿‡**å¤šè¿›ç¨‹**å®ç°å¤šæ ¸ä»»åŠ¡ã€‚

å¤šä¸ªPythonè¿›ç¨‹æœ‰å„è‡ªç‹¬ç«‹çš„GILé”ï¼Œäº’ä¸å½±å“ã€‚

Pythonçš„æ ‡å‡†åº“æä¾›äº†ä¸¤ä¸ª**æ¨¡å—**ï¼š`_thread å’Œ threading`ï¼Œ`_thread`æ˜¯ä½çº§æ¨¡å—ï¼Œ`threading`æ˜¯é«˜çº§æ¨¡å—ï¼Œå¯¹_threadè¿›è¡Œäº†å°è£…ã€‚

ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨threadingè¿™ä¸ªé«˜çº§æ¨¡å—ã€‚

**12.2.1 å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯æŠŠä¸€ä¸ªå‡½æ•°ä¼ å…¥å¹¶åˆ›å»ºThreadå®ä¾‹ï¼Œç„¶åè°ƒç”¨start()å¼€å§‹æ‰§è¡Œï¼š** 

```python3
# æ ‡å‡†æ ¼å¼`t = threading.Thread(target= 'å­çº¿ç¨‹å‡½æ•°', args=('å­çº¿ç¨‹å‡½æ•°æ‰€çš„å‚æ•°åˆ—è¡¨',), name='å­çº¿ç¨‹å')`
threading.current_thread()           #è¿”å›å½“å‰è¿è¡Œçš„çº¿ç¨‹å®ä¾‹
threading.Thread(group=None, target=None, name=None, args=(), kwargs={})          class
threading.Thread.is_alive()   
threading.Thread.start()
threading.Thread.join()
threading.Thread.setDaemon(True)         #å®ˆæŠ¤çº¿ç¨‹  ä¸»çº¿ç¨‹é€€å‡ºçš„æ—¶å€™ï¼Œä¸ç®¡å­çº¿ç¨‹è¿è¡Œåˆ°å“ªé‡Œï¼Œå¼ºè¡Œè®©å­çº¿ç¨‹é€€å‡º,éœ€è¦æ³¨æ„çš„æ˜¯ setDaemon(True) åœ¨ start() ä¹‹å‰
threading.Lock().acquire()
threading.Lock().release()
threading.local()                      # åˆ›å»ºThreadLocalå¯¹è±¡
Queue()              class
```
ç”±äºä»»ä½•**è¿›ç¨‹**é»˜è®¤å°±ä¼šå¯åŠ¨ä¸€ä¸ª**çº¿ç¨‹**ï¼Œæˆ‘ä»¬æŠŠè¯¥çº¿ç¨‹ç§°ä¸º**ä¸»çº¿ç¨‹**ï¼Œä¸»çº¿ç¨‹åˆå¯ä»¥å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œ

Pythonçš„`threadingæ¨¡å—`æœ‰ä¸ª`current_thread()å‡½æ•°`ï¼Œå®ƒæ°¸è¿œ**è¿”å›å½“å‰çº¿ç¨‹çš„å®ä¾‹**ã€‚ä¸»çº¿ç¨‹å®ä¾‹çš„åå­—å«MainThreadï¼Œ

å­çº¿ç¨‹çš„**åå­—åœ¨åˆ›å»ºæ—¶ç”¨nameå‚æ•°æŒ‡å®š**ï¼Œæˆ‘ä»¬ç”¨LoopThreadå‘½åå­çº¿ç¨‹ã€‚åå­—ä»…ä»…åœ¨æ‰“å°æ—¶ç”¨æ¥æ˜¾ç¤ºï¼Œå®Œå…¨æ²¡æœ‰å…¶ä»–æ„ä¹‰ï¼Œ

å¦‚æœä¸èµ·åå­—Pythonå°±è‡ªåŠ¨ç»™çº¿ç¨‹å‘½åä¸ºThread-1ï¼ŒThread-2â€¦â€¦
```python3
import time, threading

# æ–°çº¿ç¨‹æ‰§è¡Œçš„ä»£ç :
def loop():                                                              # æ–°çº¿ç¨‹çš„ä»£ç 
    print('thread %s is running...' % threading.current_thread().name)   # print(threading.current_thread().name)=ä¼ å…¥çš„å­çº¿ç¨‹çš„åå­—ï¼Œæ­¤å¤„ä¸ºthreading.Thread(target=loop, name='LoopThread')ä¸­çš„LoopThread
    n = 0
    while n < 5:
        n = n + 1
        print('thread %s >>> %s' % (threading.current_thread().name, n))
        time.sleep(1)
    print('thread %s ended.' % threading.current_thread().name)

print('thread %s is running...' % threading.current_thread().name)   # MainThread æ­£åœ¨è¿è¡Œ
t = threading.Thread(target=loop, name='LoopThread')                 # Threadä¸­ä¼ å…¥loopå‡½æ•°ï¼ŒåŠnameå‚æ•°ï¼ˆå­çº¿ç¨‹åï¼‰ï¼Œåˆ›å»ºThreadå­çº¿ç¨‹å®ä¾‹
t.start()                                                            # å­çº¿ç¨‹å¼€å§‹æ‰§è¡Œ
t.join()                                                             # ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹æ‰§è¡Œå®Œå†é€€å‡º
print('thread %s ended.' % threading.current_thread().name)          # MainThread æ‰§è¡Œå®Œæ¯•

##### è¾“å‡º
thread MainThread is running...
thread LoopThread is running...
thread LoopThread >>> 1
thread LoopThread >>> 2
thread LoopThread >>> 3
thread LoopThread >>> 4
thread LoopThread >>> 5
thread LoopThread ended.
thread MainThread ended.
#####
join()æ–¹æ³•ä½œç”¨     
MainThreadåœ¨joinä¹‹åä¸€ç›´åœåœ¨joinçš„åœ°æ–¹ï¼Œç­‰å¾…å­çº¿ç¨‹ LoopThread é€€å‡ºåæ‰ç»§ç»­æ‰§è¡Œä¸‹å»
æ²¡æœ‰join()æ–¹æ³•çš„ç»“æœ
##### 
thread MainThread is running...
thread LoopThread is running...
thread MainThread ended.
thread LoopThread >>> 1
thread LoopThread >>> 2
thread LoopThread >>> 3
thread LoopThread >>> 4
thread LoopThread >>> 5
thread LoopThread ended.
```

```python3
import threading
import time


def long_time_task(i):
    print('å½“å‰å­çº¿ç¨‹: {} - ä»»åŠ¡{}'.format(threading.current_thread().name, i))
    time.sleep(2)
    print("ç»“æœ: {}".format(8 ** 20))


if __name__=='__main__':
    start = time.time()
    print('è¿™æ˜¯ä¸»çº¿ç¨‹ï¼š{}'.format(threading.current_thread().name))
    t1 = threading.Thread(target=long_time_task, args=(1,))
    t2 = threading.Thread(target=long_time_task, args=(2,))
    t1.start()
    t2.start()

    end = time.time()
    print("æ€»å…±ç”¨æ—¶{}ç§’".format((end - start)))
#
è¿™æ˜¯ä¸»çº¿ç¨‹ï¼šMainThread
å½“å‰å­çº¿ç¨‹: Thread-1 - ä»»åŠ¡1
å½“å‰å­çº¿ç¨‹: Thread-2 - ä»»åŠ¡2
æ€»å…±ç”¨æ—¶0.0017192363739013672ç§’
ç»“æœ: 1152921504606846976
ç»“æœ: 1152921504606846976
#
#ä¸ºä»€ä¹ˆæ€»è€—æ—¶å±…ç„¶æ˜¯0ç§’? æˆ‘ä»¬å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹å…¶å®æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œä¸»çº¿ç¨‹æ ¹æœ¬æ²¡æœ‰ç­‰å­çº¿ç¨‹å®Œæˆï¼Œè€Œæ˜¯è‡ªå·±ç»“æŸåå°±æ‰“å°äº†æ¶ˆè€—æ—¶é—´ã€‚
#ä¸»çº¿ç¨‹ç»“æŸåï¼Œå­çº¿ç¨‹ä»åœ¨ç‹¬ç«‹è¿è¡Œï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„
```

å¦‚æœè¦å®ç°ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„åŒæ­¥ï¼Œæˆ‘ä»¬å¿…éœ€ä½¿ç”¨joinæ–¹æ³•

```python3
# å¦‚æœè¦å®ç°ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹çš„åŒæ­¥ï¼Œæˆ‘ä»¬å¿…éœ€ä½¿ç”¨joinæ–¹æ³•
import threading
import time


def long_time_task(i):
    print('å½“å‰å­çº¿ç¨‹: {} ä»»åŠ¡{}'.format(threading.current_thread().name, i))
    time.sleep(2)
    print("ç»“æœ: {}".format(8 ** 20))


if __name__=='__main__':
    start = time.time()
    print('è¿™æ˜¯ä¸»çº¿ç¨‹ï¼š{}'.format(threading.current_thread().name))
    thread_list = []
    for i in range(1, 3):
        t = threading.Thread(target=long_time_task, args=(i, ))
        thread_list.append(t)

    for t in thread_list:
        t.start()

    for t in thread_list:
        t.join()     

    end = time.time()
    print("æ€»å…±ç”¨æ—¶{}ç§’".format((end - start)))
    
#
è¿™æ˜¯ä¸»çº¿ç¨‹ï¼šMainThread
å½“å‰å­çº¿ç¨‹: Thread - 1 ä»»åŠ¡1
å½“å‰å­çº¿ç¨‹: Thread - 2 ä»»åŠ¡2
ç»“æœ: 1152921504606846976
ç»“æœ: 1152921504606846976
æ€»å…±ç”¨æ—¶2.0166890621185303ç§’
```

å½“æˆ‘ä»¬è®¾ç½®å¤šçº¿ç¨‹æ—¶ï¼Œä¸»çº¿ç¨‹ä¼šåˆ›å»ºå¤šä¸ªå­çº¿ç¨‹ï¼Œåœ¨pythonä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸»çº¿ç¨‹å’Œå­çº¿ç¨‹ç‹¬ç«‹è¿è¡Œäº’ä¸å¹²æ¶‰ã€‚

å¦‚æœå¸Œæœ›è®©ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å®ç°çº¿ç¨‹çš„åŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨join()æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªä¸»çº¿ç¨‹ç»“æŸæ—¶ä¸å†æ‰§è¡Œå­çº¿ç¨‹ï¼Œ

æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢? æˆ‘ä»¬å¯ä»¥ä½¿ç”¨t.setDaemon(True)

```python3
import threading
import time


def long_time_task():
    print('å½“å­çº¿ç¨‹: {}'.format(threading.current_thread().name))
    time.sleep(2)
    print("ç»“æœ: {}".format(8 ** 20))


if __name__=='__main__':
    start = time.time()
    print('è¿™æ˜¯ä¸»çº¿ç¨‹ï¼š{}'.format(threading.current_thread().name))
    for i in range(5):
        t = threading.Thread(target=long_time_task, args=())
        t.setDaemon(True)
        t.start()

    end = time.time()
    print("æ€»å…±ç”¨æ—¶{}ç§’".format((end - start)))

```
**12.2.2 é€šè¿‡ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•åˆ›å»ºæ–°çº¿ç¨‹**

é™¤äº†ä½¿ç”¨Thread()æ–¹æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç»§æ‰¿Threadç±»é‡å†™runæ–¹æ³•åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œè¿™ç§æ–¹æ³•æ›´çµæ´»ã€‚

ä¸‹ä¾‹ä¸­æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ä¸ºMyThread, éšåæˆ‘ä»¬é€šè¿‡è¯¥ç±»çš„å®ä¾‹åŒ–åˆ›å»ºäº†2ä¸ªå­çº¿ç¨‹ã€‚

```python3
import threading
import time


def long_time_task(i):
    time.sleep(2)
    return 8**20


class MyThread(threading.Thread):
    def __init__(self, func, args , name='', ):
        threading.Thread.__init__(self)
        self.func = func
        self.args = args
        self.name = name
        self.result = None

    def run(self):
        print('å¼€å§‹å­çº¿ç¨‹{}'.format(self.name))
        self.result = self.func(self.args[0],)
        print("ç»“æœ: {}".format(self.result))
        print('ç»“æŸå­çº¿ç¨‹{}'.format(self.name))


if __name__=='__main__':
    start = time.time()
    threads = []
    for i in range(1, 3):
        t = MyThread(long_time_task, (i,), str(i))
        threads.append(t)

    for t in threads:
        t.start()
    for t in threads:
        t.join()

    end = time.time()
    print("æ€»å…±ç”¨æ—¶{}ç§’".format((end - start)))


# è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤º:
å¼€å§‹å­çº¿ç¨‹1
å¼€å§‹å­çº¿ç¨‹2
ç»“æœ: 1152921504606846976
ç»“æœ: 1152921504606846976
ç»“æŸå­çº¿ç¨‹1
ç»“æŸå­çº¿ç¨‹2
æ€»å…±ç”¨æ—¶2.005445718765259ç§’
```


**12.2.3 ä¸åŒçº¿ç¨‹é—´çš„æ•°æ®å…±äº« æ¯”è¾ƒå±é™© é€šå¸¸éœ€è¦åŠ é” threading.Lock**

   ä¸€ä¸ªè¿›ç¨‹æ‰€å«çš„ä¸åŒçº¿ç¨‹é—´å…±äº«å†…å­˜ï¼Œè¿™å°±æ„å‘³ç€ä»»ä½•ä¸€ä¸ªå˜é‡éƒ½å¯ä»¥è¢«ä»»ä½•ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼Œå› æ­¤çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®æœ€å¤§çš„å±é™©åœ¨äºå¤šä¸ªçº¿ç¨‹åŒæ—¶æ”¹ä¸€ä¸ªå˜é‡ï¼Œ

æŠŠå†…å®¹ç»™æ”¹ä¹±äº†ã€‚å¦‚æœä¸åŒçº¿ç¨‹é—´æœ‰å…±äº«çš„å˜é‡ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹æ³•å°±æ˜¯åœ¨ä¿®æ”¹å‰ç»™å…¶ä¸Šä¸€æŠŠé”lockï¼Œç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹å®ƒã€‚

threading.lock()æ–¹æ³•å¯ä»¥è½»æ˜“å®ç°å¯¹ä¸€ä¸ªå…±äº«å˜é‡çš„é”å®šï¼Œä¿®æ”¹å®Œåreleaseä¾›å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚æ¯”å¦‚ä¸‹ä¾‹ä¸­è´¦æˆ·ä½™é¢balanceæ˜¯ä¸€ä¸ªå…±äº«å˜é‡ï¼Œ

ä½¿ç”¨lockå¯ä»¥ä½¿å…¶ä¸è¢«æ”¹ä¹±ã€‚

```python3
lock = threading.Lock()                # åˆ›å»ºä¸€ä¸ªé”
def run_thread(n):
    for i in range(100000):        
        lock.acquire()                 # å…ˆè¦è·å–é”
        try:           
            change_it(n)               # æ‰§è¡Œä¸€æ®µä»£ç 
        finally:            
            lock.release()             # æ‰§è¡Œä»£ç å®Œäº†ä¸€å®šè¦é‡Šæ”¾é”,try...finally ç¡®ä¿é”ä¸€å®šä¼šè¢«é‡Šæ”¾ã€‚
```
```python3
import threading


class Account:
    def __init__(self):
        self.balance = 0

    def add(self, lock):
        # è·å¾—é”
        lock.acquire()
        for i in range(0, 100000):
            self.balance += 1
        # é‡Šæ”¾é”
        lock.release()

    def delete(self, lock):
        # è·å¾—é”
        lock.acquire()
        for i in range(0, 100000):
            self.balance -= 1
        # é‡Šæ”¾é”
        lock.release()


if __name__ == "__main__":
    account = Account()
    lock = threading.Lock()
    # åˆ›å»ºçº¿ç¨‹
    thread_add = threading.Thread(target=account.add, args=(lock,), name='Add')
    thread_delete = threading.Thread(target=account.delete, args=(lock,), name='Delete')

    # å¯åŠ¨çº¿ç¨‹
    thread_add.start()
    thread_delete.start()

    # ç­‰å¾…çº¿ç¨‹ç»“æŸ 
    thread_add.join()
    thread_delete.join()

    print('The final balance is: {}'.format(account.balance))
```
å¦ä¸€ç§å®ç°ä¸åŒçº¿ç¨‹é—´æ•°æ®å…±äº«çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—queueã€‚ä¸åƒåˆ—è¡¨ï¼Œ**queueæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒä½¿ç”¨**ï¼Œè§ä¸‹æ–‡
 
**ä½¿ç”¨queueé˜Ÿåˆ—é€šä¿¡-ç»å…¸çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹**

ä¸‹ä¾‹ä¸­åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£ç”Ÿæˆï¼Œä¸€ä¸ªè´Ÿè´£æ¶ˆè´¹ï¼Œæ‰€ç”Ÿæˆçš„äº§å“å­˜æ”¾åœ¨queueé‡Œï¼Œå®ç°äº†ä¸åŒçº¿ç¨‹é—´æ²Ÿé€šã€‚

```python3
from queue import Queue
import random, threading, time


# ç”Ÿäº§è€…ç±»
class Producer(threading.Thread):
    def __init__(self, name, queue):
        threading.Thread.__init__(self, name=name)
        self.queue = queue

    def run(self):
        for i in range(1, 5):
            print("{} is producing {} to the queue!".format(self.getName(), i))
            self.queue.put(i)
            time.sleep(random.randrange(10) / 5)
        print("%s finished!" % self.getName())


# æ¶ˆè´¹è€…ç±»
class Consumer(threading.Thread):
    def __init__(self, name, queue):
        threading.Thread.__init__(self, name=name)
        self.queue = queue

    def run(self):
        for i in range(1, 5):
            val = self.queue.get()
            print("{} is consuming {} in the queue.".format(self.getName(), val))
            time.sleep(random.randrange(10))
        print("%s finished!" % self.getName())


def main():
    queue = Queue()
    producer = Producer('Producer', queue)
    consumer = Consumer('Consumer', queue)

    producer.start()
    consumer.start()

    producer.join()
    consumer.join()
    print('All threads finished!')


if __name__ == '__main__':
    main()
```
**é˜Ÿåˆ—queueçš„putæ–¹æ³•**å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡objæ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œæ­¤æ–¹æ³•å°†é˜»å¡è‡³é˜Ÿåˆ—æœ‰ç©ºé—´å¯ç”¨ä¸ºæ­¢ã€‚

**queueçš„getæ–¹æ³•**ä¸€æ¬¡è¿”å›é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæˆå‘˜ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œæ­¤æ–¹æ³•å°†é˜»å¡è‡³é˜Ÿåˆ—ä¸­æœ‰æˆå‘˜å¯ç”¨ä¸ºæ­¢ã€‚

queueåŒæ—¶è¿˜è‡ªå¸¦emtpy(), full()ç­‰æ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªé˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºæˆ–å·²æ»¡ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•å¹¶ä¸å¯é ï¼Œ

å› ä¸ºå¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹ï¼Œåœ¨è¿”å›ç»“æœå’Œä½¿ç”¨ç»“æœä¹‹é—´ï¼Œé˜Ÿåˆ—ä¸­å¯èƒ½æ·»åŠ /åˆ é™¤äº†æˆå‘˜ã€‚



>>> **12.3 ThreadLocal**

ä¸€ä¸ªThreadLocalå˜é‡è™½ç„¶æ˜¯å…¨å±€å˜é‡ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½åªèƒ½è¯»å†™è‡ªå·±çº¿ç¨‹çš„ç‹¬ç«‹å‰¯æœ¬ï¼Œäº’ä¸å¹²æ‰°ã€‚ThreadLocalè§£å†³äº†å‚æ•°åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å„ä¸ªå‡½æ•°ä¹‹é—´äº’ç›¸ä¼ é€’çš„é—®é¢˜ã€‚

```python3
import threading
   
local_school = threading.local()                      # åˆ›å»ºå…¨å±€ThreadLocalå¯¹è±¡
# print(type(local_school))        #  <class '_thread._local'>

def process_student():    
    std = local_school.student                        # è·å–å½“å‰çº¿ç¨‹å…³è”çš„student
    print('Hello, %s (in %s)' % (std, threading.current_thread().name))


def process_thread(std_name):    
    local_school.student = std_name                   # ç»‘å®šThreadLocalçš„student   local_school.studentï¼Ÿï¼Ÿï¼Ÿlocal_schoolçš„å±æ€§ï¼Ÿ
    process_student()


t1 = threading.Thread(target=process_thread, args=('Alice',), name='Thread-A')  # æ­¤å¤„argsä¼ ç»™process_threadå‡½æ•°çš„std_name,  nameæŒ‡å®šå­çº¿ç¨‹çš„åå­—ï¼Œä¼ ç»™threading.current_thread().nameï¼Œä¸ä¼ åˆ™ä¸ºThread-1ï¼Œ Thread-2
t2 = threading.Thread(target=process_thread, args=('Bob',), name='Thread-A')
t1.start()
t2.start()
t1.join()
t2.join()
```

>>> **12.4 åˆ†å¸ƒå¼è¿›ç¨‹**

å¯ä»¥åœ¨å¤šå°æœºå­ä¸Šè·‘

##### task_master.py
```python3
import random, time, queue                                                                    å³ä¾§ä¸ºæ¨¡å—åŒ–çš„ä¸œè¥¿
from multiprocessing.managers import BaseManager                                              managersä¸ºmultiprocessingçš„å­æ¨¡å—

# å‘é€  ä»»åŠ¡task_queue  çš„é˜Ÿåˆ—:
task_queue = queue.Queue()                                                                    queue.Queue()
# æ¥æ”¶  ç»“æœresult_queue çš„é˜Ÿåˆ—:
result_queue = queue.Queue()                                                                  queue.Queue()

# ä»BaseManagerç»§æ‰¿çš„QueueManager:
class QueueManager(BaseManager):
    pass

# æŠŠä¸¤ä¸ªQueueéƒ½æ³¨å†Œåˆ°ç½‘ç»œä¸Š, callableå‚æ•°å…³è”äº†Queueå¯¹è±¡:
QueueManager.register('get_task_queue', callable=lambda: task_queue)                            QueueManager.register
QueueManager.register('get_result_queue', callable=lambda: result_queue)
# ç»‘å®šç«¯å£5000, è®¾ç½®éªŒè¯ç 'abc':
manager = QueueManager(address=('', 5000), authkey=b'abc')                                      ç»‘å®š QueueManager(address=('', 5000), authkey=b'abc')
# å¯åŠ¨Queue:
manager.start()                                                                                 QueueManager.start()
# è·å¾—é€šè¿‡ç½‘ç»œè®¿é—®çš„Queueå¯¹è±¡:
task = manager.get_task_queue()                                                                 QueueManager.get_task_queue()
result = manager.get_result_queue()                                                             QueueManager.get_result_queue()
# æ”¾å‡ ä¸ªä»»åŠ¡è¿›å»:
for i in range(10):
    n = random.randint(0, 10000)
    print('Put task %d...' % n)
    task.put(n)                                                   QueueManager.get_task_queue().put(n)
# ä»resulté˜Ÿåˆ—è¯»å–ç»“æœ:
print('Try get results...')
for i in range(10):
    r = result.get(timeout=10)                                    QueueManager.get_result_queue().get(timeout=10) 
    print('Result: %s' % r)
# å…³é—­:
manager.shutdown()                                                QueueManager.shutdown()
print('master exit.')
```
##### task_worker.py  å¦ä¸€å°æœºå­
```python3
import time, sys, queue
from multiprocessing.managers import BaseManager

# åˆ›å»ºç±»ä¼¼çš„QueueManager:
class QueueManager(BaseManager):
    pass

# ç”±äºè¿™ä¸ªQueueManageråªä»ç½‘ç»œä¸Šè·å–Queueï¼Œæ‰€ä»¥æ³¨å†Œæ—¶åªæä¾›åå­—:
QueueManager.register('get_task_queue')                                           QueueManager.register
QueueManager.register('get_result_queue')

# è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œtask_master.pyçš„æœºå™¨:
server_addr = '127.0.0.1'
print('Connect to server %s...' % server_addr)
# ç«¯å£å’ŒéªŒè¯ç æ³¨æ„ä¿æŒä¸task_master.pyè®¾ç½®çš„å®Œå…¨ä¸€è‡´:
m = QueueManager(address=(server_addr, 5000), authkey=b'abc')                      ç»‘å®šQueueManager
# ä»ç½‘ç»œè¿æ¥:
m.connect()                                                                          QueueManager.connect()
# è·å–Queueçš„å¯¹è±¡:
task = m.get_task_queue()                                                            QueueManager.get_task_queue()
result = m.get_result_queue()                                                        QueueManager.get_result_queue()
# ä»taské˜Ÿåˆ—å–ä»»åŠ¡,å¹¶æŠŠç»“æœå†™å…¥resulté˜Ÿåˆ—:
for i in range(10):
    try:
        n = task.get(timeout=1)                                                 QueueManager.get_task_queue().get()
        print('run task %d * %d...' % (n, n))
        r = '%d * %d = %d' % (n, n, n*n)
        time.sleep(1)
        result.put(r)                                                           QeueManager.get_result_queue().put(r)
    except Queue.Empty:
        print('task queue is empty.')
# å¤„ç†ç»“æŸ:
print('worker exit.')
```
Queue ä¹‹æ‰€ä»¥èƒ½é€šè¿‡ç½‘ç»œè®¿é—®ï¼Œå°±æ˜¯é€šè¿‡ QueueManager å®ç°çš„ã€‚ä¹Ÿå°±æ˜¯ QueueManager ç®¡ç†ç€ä¼—å¤šçš„ Queueï¼Œå‚è€ƒå»–é›ªå³°çš„å›¾æ›´å¥½ç†è§£
