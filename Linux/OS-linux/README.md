深入分析Linux内核源码

## Linux 内核

进程调度、内存管理、进程间通信、虚拟文件系统及网络接口

## misc

> Linux 内核的特征

```
（1）Linux 内核的组织形式为整体式结构。
（2）Linux 的进程调度方式简单而有效
（3）Linux 支持内核线程（或称守护进程）。
（4）Linux 支持多种平台的虚拟内存管理。
（5）Linux 内核另一个独具特色的部分是虚拟文件系统（VFS Virtul File Systen）。
（6）Linux 的模块机制使得内核保持独立而又易于扩充。
（7）增加系统调用以满足特殊的需求。
（8）网络部分面向对象的设计思想使得Linux 内核支持多种协议、多种网卡驱动程序变得容易。
```

> Linux 内核结构 图片

```
1．用户进程
用户应用程序是运行在Linux 操作系统最高层的一个庞大的软件集合。当一个用户程序
在操作系统之上运行时，它成为操作系统中的一个进程。
2．系统调用接口
在应用程序中，可通过系统调用来调用操作系统内核中特定的过程，以实现特定的服务。
例如，在程序中安排一条创建进程的系统调用，则操作系统内核便会为之创建一个新进程。
系统调用本身也是由若干条指令构成的过程。但它与一般的过程不同，主要区别是：系
统调用是运行在内核态（或叫系统态），而一般过程是运行在用户态。在Linux 中，系统调
用是内核代码的一部分。
3．Linux 内核
这是本书要讨论的重点。内核是操作系统的灵魂，它负责管理磁盘上的文件、内存，负
责启动并运行程序，负责从网络上接收和发送数据包等。简言之，内核实际是抽象的资源操
作到具体硬件操作细节之间的接口。
4．硬件
这个子系统包括了Linux 安装时需要的所有可能的物理设备。例如，CPU、 内存、硬盘、
网络硬件等。
```

> Linux 内核的抽象结构 图片

```
（1）进程调度（SCHED）控制着进程对CPU 的访问。当需要选择下一个进程运行时，由
调度程序选择最值得运行的进程。可运行进程实际是仅等待 CPU 资源的进程，如果某个进程
在等待其他资源，则该进程是不可运行进程。Linux 使用了比较简单的基于优先级的进程调
度算法选择新的进程。
（2）内存管理（MM）允许多个进程安全地共享主内存区域。Linux 的内存管理支持虚拟
内存，即在计算机中运行的程序，其代码、数据和堆栈的总量可以超过实际内存的大小，操
作系统只将当前使用的程序块保留在内存中，其余的程序块则保留在磁盘上。必要时，操作
系统负责在磁盘和内存之间交换程序块。
内存管理从逻辑上可以分为硬件无关的部分和硬件相关的部分。硬件无关的部分提供了
进程的映射和虚拟内存的对换；硬件相关的部分为内存管理硬件提供了虚拟接口。
（3）虚拟文件系统（Virtul File System，VFS）隐藏了各种不同硬件的具体细节，为
所有设备提供了统一的接口，VFS 还支持多达数十种不同的文件系统，这也是Linux 较有特
色的一部分。
虚拟文件系统可分为逻辑文件系统和设备驱动程序。逻辑文件系统指Linux 所支持的文
件系统，如ext2，fat 等，设备驱动程序指为每一种硬件控制器所编写的设备驱动程序模块。
（4）网络接口（NET）提供了对各种网络标准协议的存取和各种网络硬件的支持。网络
接口可分为网络协议和网络驱动程序两部分。网络协议部分负责实现每一种可能的网络传输
协议，网络设备驱动程序负责与硬件设备进行通信，每一种可能的硬件设备都有相应的设备
驱动程序。
（5）进程间通信（IPC） 支持进程间各种通信机制。从图1.2 所示可以看出，处于中心
位置的是进程调度，所有其他的子系统都依赖于它，因为每个子系统都需要挂起或恢复进程。
一般情况下，当一个进程等待硬件操作完成时，它被挂起；当操作真正完成时，进程被恢复
执行。例如，当一个进程通过网络发送一条消息时，网络接口需要挂起发送进程，直到硬件
成功地完成消息的发送，当消息被发送出去以后，网络接口给进程返回一个代码，表示操作
的成功或失败。其他子系统（内存管理，虚拟文件系统及进程间通信）以相似的理由依赖于
进程调度。
各个子系统之间的依赖关系如下
```

> Linux 内核源代码的结构
```
Linux 内核源代码位于/usr/src/linux 目录下，其结构分布如图1.3 所示，每一个目录
或子目录可以看作一个模块，其目录之间的连线表示“子目录或子模块”的关系。下面是对
每一个目录的简单描述。
include/目录包含了建立内核代码时所需的大部分包含文件，这个模块利用其他模块重
建内核。
init/ 子目录包含了内核的初始化代码，这是内核开始工作的起点。
arch/子目录包含了所有硬件结构特定的内核代码，如图1.3 所示，arch/子目录下有i386
和alpha 模块等。
drivers/ 目录包含了内核中所有的设备驱动程序，如块设备，scsi 设备驱动程序等。
fs/ 目录包含了所有文件系统的代码，如：ext2，vfat 模块的代码等。
net/ 目录包含了内核的连网代码。
mm/ 目录包含了所有的内存管理代码。
ipc/ 目录包含了进程间通信的代码。
kernel/ 目录包含了主内核代码。
```


操作系统

https://www.cnblogs.com/kexinxin/category/1338888.html



[垃圾回收](https://juejin.im/post/5cf0ffa7f265da1ba56b052a)

[Java 垃圾回收](https://mp.weixin.qq.com/s/Pj0HHwHG5NJhduYOf6R8xQ)

# 进程 线程

### 进程间通信

### 死锁

[死锁产生的 必要条件](https://juejin.im/entry/5a6bd9bc518825732258ee76)
[1死锁产生的 必要条件 2解决办法](https://www.liuchuo.net/archives/1708)
```
1）互斥条件：
指进程对所分配到的资源进行排它性使用，即在一段时间内某资源只由一个进程占用。如果此时还有其它进程
请求资源，则请求者只能等待，直至占有资源的进程用毕释放。
2）请求和保持条件：
指进程已经保持至少一个资源，但又提出了新的资源请求，而该资源已被其它进程占有，此时请求进程阻塞，
但又对自己已获得的其它资源保持不放。
3）不剥夺条件：
指进程已获得的资源，在未使用完之前，不能被剥夺，只能在使用完时由自己释放。
4）环路等待条件：
指在发生死锁时，必然存在一个进程——资源的环形链，即进程集合{P0，P1，P2，···，Pn}中的P0正在等待一个
P1占用的资源；P1正在等待P2占用的资源，……，Pn正在等待已被P0占用的资源。
```
